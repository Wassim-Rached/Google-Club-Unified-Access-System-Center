<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Club Health Check</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      .server-status-item {
        margin-bottom: 10px;
        padding: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <h1 class="text-center mb-4">Google Club Servers Health Check</h1>

      <button type="button" class="btn btn-secondary mb-4">
        <a style="text-decoration: none; color: inherit" href="index.html"
          >Go Back</a
        >
      </button>

      <div id="serverStatus" class="card mb-4">
        <div class="card-header bg-primary text-white">Server Status</div>
        <ul class="list-group list-group-flush"></ul>
      </div>

      <div class="card">
        <div class="card-header bg-primary text-white">Clients</div>
        <div id="generatedLinks" class="list-group list-group-flush p-3"></div>
      </div>
    </div>
    <script>
      const linksArray = [
        {
          name: "Account Management Web Client",
          url: "https://account-manager-eta.vercel.app",
        },
        // {
        //   name: "Formular User Web Client",
        //   url: "https://google-forms-tau.vercel.app",
        // },
        {
          name: "Account Console Web Client",
          url: "https://accounts-console.vercel.app",
        },
        // {
        //   name: "Formular Admin Web Client",
        //   url: "https://formular-administration.vercel.app",
        // },
      ];

      function generateLinksHTML(links) {
        return links
          .map(
            (link) =>
              `<a href="${link.url}" target="_blank" class="list-group-item list-group-item-action mb-2">
      <span>${link.name}</span>
      <span class="badge bg-primary rounded-pill">Visit</span>
      </a>`
          )
          .join("");
      }

      document.getElementById("generatedLinks").innerHTML =
        generateLinksHTML(linksArray);
    </script>
    <script>
      const serverEndpoints = [
        "https://cas-server.azurewebsites.net/api/health",
        "https://ics-server.azurewebsites.net/api/health",
        // "https://fas-server.azurewebsites.net/api/health",
        // "https://fus-server.azurewebsites.net/api/health",
      ];

      async function checkServerHealth(endpoint) {
        try {
          const response = await fetch(endpoint, { timeout: 5000 }); // Set a 5-second timeout
          const data = await response.json();
          return {
            url: endpoint,
            status: data.status,
            code: response.status,
            body: data.body,
            error: null,
          };
        } catch (error) {
          return {
            url: endpoint,
            status: "Error",
            code: 500,
            body: null,
            error: error.message,
          };
        }
      }

      async function getAllServerStatuses() {
        const serverStatuses = await Promise.all(
          serverEndpoints.map(checkServerHealth)
        );
        return serverStatuses;
      }

      getAllServerStatuses()
        .then((serverStatuses) => {
          const serverStatusDiv = document.getElementById("serverStatus");
          serverStatusDiv.innerHTML = generateStatusHTML(serverStatuses);
        })
        .catch((error) => {
          console.error("Error fetching health check data:", error);
          serverStatusDiv.innerHTML = "Failed to fetch health check data";
        });

      function generateStatusHTML(serverStatuses) {
        let html = "";
        serverStatuses.forEach((serverStatus) => {
          html +=
            "<li class='list-group-item d-flex justify-content-between align-items-center server-status-item'>";
          html += "<span><strong>" + serverStatus.url + "</strong>: ";
          if (serverStatus.status === "healthy") {
            html +=
              "<span class='text-success'>" + serverStatus.status + "</span>";
          } else {
            html +=
              "<span class='text-danger'>" + serverStatus.status + "</span>";
          }
          html += " (Code: " + serverStatus.code + ")";
          if (serverStatus.error) {
            html += "<br>Error: " + serverStatus.error;
          }
          if (serverStatus.body) {
            html += "<br>Body: " + JSON.stringify(serverStatus.body);
          }
          html += "</span></li>";
        });
        return html;
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-fIuFwJOqjqr5lqlqvjQfPqVEj7mWq7amYAm2CrcuqzEufQzC5yRkJvuz0aTupdqr"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
