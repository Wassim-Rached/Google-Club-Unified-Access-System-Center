<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SOA Server Health Check</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-DONjkF8CAQxX+jXnkTKvCJSklHJTQkWjIvooYjQzcbSlCjyJyCECqYOqDYwMjOe/"
      crossorigin="anonymous"
    />
    <style>
      .container {
        max-width: 800px;
        margin: 2rem auto;
      }
      .card {
        border-color: #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .card-header {
        background-color: #f8f9fa;
        color: #333;
      }
      .list-group-item {
        padding: 1rem 1.5rem;
      }
      .list-group-item:first-child {
        border-top-left-radius: 0.3rem;
        border-top-right-radius: 0.3rem;
      }
      .list-group-item:last-child {
        border-bottom-left-radius: 0.3rem;
        border-bottom-right-radius: 0.3rem;
      }
      .server-healthy {
        color: #28a745;
      }
      .server-unhealthy {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center">Google Club Servers Health Check</h1>

      <div id="serverStatus" class="card mt-3">
        <div class="card-header">Server Status</div>
        <ul class="list-group list-group-flush"></ul>
      </div>
    </div>

    <div class="container mt-5">
      <h2 class="text-center">Client Portals</h2>
      <div class="list-group">
        <a
          href="https://client1.example.com"
          class="list-group-item list-group-item-action"
          >Client 1 Portal</a
        >
        <a
          href="https://client2.example.com"
          class="list-group-item list-group-item-action"
          >Client 2 Portal</a
        >
        <a
          href="https://client3.example.com"
          class="list-group-item list-group-item-action"
          >Client 3 Portal</a
        >
        <a
          href="https://client4.example.com"
          class="list-group-item list-group-item-action"
          >Client 4 Portal</a
        >
      </div>
    </div>
    <div class="container mt-5">
      <h2 class="text-center">Generated Links</h2>
      <div id="generatedLinks" class="list-group"></div>
    </div>

    <script>
      const linksArray = [
        {
          name: "Account Management Web Client",
          url: "https://account-manager-eta.vercel.app",
        },
        {
          name: "Formular User Web Client",
          url: "https://google-forms-tau.vercel.app",
        },
        {
          name: "Account Console Web Client",
          url: "https://account-console.vercel.app",
        },
        {
          name: "Formular Admin Web Client",
          url: "https://formular-administration.vercel.app",
        },
      ];

      function generateLinksHTML(links) {
        return links
          .map(
            (link) =>
              `<a href="${link.url}" class="list-group-item list-group-item-action">${link.name}</a>`
          )
          .join("");
      }

      document.getElementById("generatedLinks").innerHTML =
        generateLinksHTML(linksArray);
    </script>

    <script>
      const serverEndpoints = [
        "https://cas-server.azurewebsites.net/api/health",
        "https://ics-server.azurewebsites.net/api/health",
        "https://fas-server.azurewebsites.net/api/health",
        "https://fus-server.azurewebsites.net/api/health",
      ];

      async function checkServerHealth(endpoint) {
        try {
          const response = await fetch(endpoint, { timeout: 5000 }); // Set a 5-second timeout
          const data = await response.json();
          return {
            url: endpoint,
            status: data.status,
            code: response.status,
            body: data.body,
            error: null,
          };
        } catch (error) {
          return {
            url: endpoint,
            status: "Error",
            code: 500,
            body: null,
            error: error.message,
          };
        }
      }

      async function getAllServerStatuses() {
        const serverStatuses = await Promise.all(
          serverEndpoints.map(checkServerHealth)
        );
        return serverStatuses;
      }

      getAllServerStatuses()
        .then((serverStatuses) => {
          const serverStatusDiv = document.getElementById("serverStatus");
          serverStatusDiv.innerHTML = generateStatusHTML(serverStatuses);
        })
        .catch((error) => {
          console.error("Error fetching health check data:", error);
          serverStatusDiv.innerHTML = "Failed to fetch health check data";
        });

      function generateStatusHTML(serverStatuses) {
        let html = "";
        serverStatuses.forEach((serverStatus) => {
          html += "<li class='list-group-item'>";
          html += "<strong>" + serverStatus.url + "</strong>: ";
          if (serverStatus.status === "healthy") {
            html +=
              "<span class='server-healthy'>" + serverStatus.status + "</span>";
          } else {
            html +=
              "<span class='server-unhealthy'>" +
              serverStatus.status +
              "</span>";
          }
          html += " (Code: " + serverStatus.code + ")";
          if (serverStatus.error) {
            html += "<br>Error: " + serverStatus.error;
          }
          if (serverStatus.body) {
            html += "<br>Body: " + JSON.stringify(serverStatus.body);
          }
          html += "</li>";
        });
        return html;
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-fIuFwJOqjqr5lqlqvjQfPqVEj7mWq7amYAm2CrcuqzEufQzC5yRkJvuz0aTupdqr"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
